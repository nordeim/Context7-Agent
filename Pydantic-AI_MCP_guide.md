Based on the latest pydantic-ai documentation, here's a comprehensive guide for creating AI agents with OpenAI as the LLM and Context7 as an MCP server for tool calling:                                                                │
                                                                                                                                                                                                                                         │
## Quick Start: OpenAI + MCP Server Setup                                                                                                                                                                                                │
                                                                                                                                                                                                                                         │
### 1. Basic Agent with OpenAI                                                                                                                                                                                                           │
                                                                                                                                                                                                                                         │
```python                                                                                                                                                                                                                                │
from pydantic_ai import Agent                                                                                                                                                                                                            │
                                                                                                                                                                                                                                         │
# Simple OpenAI agent (requires OPENAI_API_KEY environment variable)                                                                                                                                                                     │
agent = Agent('openai:gpt-4o')                                                                                                                                                                                                           │
                                                                                                                                                                                                                                         │
# Or with explicit model initialization                                                                                                                                                                                                  │
from pydantic_ai.models.openai import OpenAIModel                                                                                                                                                                                        │
model = OpenAIModel('gpt-4o')                                                                                                                                                                                                            │
agent = Agent(model)                                                                                                                                                                                                                     │
```                                                                                                                                                                                                                                      │
                                                                                                                                                                                                                                         │
### 2. MCP Server Integration                                                                                                                                                                                                            │
                                                                                                                                                                                                                                         │
#### HTTP SSE Server Connection                                                                                                                                                                                                          │
```python                                                                                                                                                                                                                                │
from pydantic_ai import Agent                                                                                                                                                                                                            │
from pydantic_ai.mcp import MCPServerHTTP                                                                                                                                                                                                │
                                                                                                                                                                                                                                         │
# Connect to Context7 MCP server via HTTP SSE                                                                                                                                                                                            │
server = MCPServerHTTP(url='http://localhost:3001/sse')                                                                                                                                                                                  │
agent = Agent('openai:gpt-4o', mcp_servers=)                                                                                                                                                                                             │
                                                                                                                                                                                                                                         │
async def main():                                                                                                                                                                                                                        │
    async with agent.run_mcp_servers():                                                                                                                                                                                                  │
        result = await agent.run('Search Context7 for latest pydantic-ai docs')                                                                                                                                                          │
        print(result.output)                                                                                                                                                                                                             │
```                                                                                                                                                                                                                                      │
                                                                                                                                                                                                                                         │
#### Stdio Server Connection                                                                                                                                                                                                             │
```python                                                                                                                                                                                                                                │
from pydantic_ai.mcp import MCPServerStdio                                                                                                                                                                                               │
                                                                                                                                                                                                                                         │
# Connect to Context7 MCP server via stdio                                                                                                                                                                                               │
server = MCPServerStdio(                                                                                                                                                                                                                 │
    'deno',                                                                                                                                                                                                                              │
    args=[                                                                                                                                                                                                                               │
        'run',                                                                                                                                                                                                                           │
        '-N',                                                                                                                                                                                                                            │
        '-R=node_modules',                                                                                                                                                                                                               │
        '-W=node_modules',                                                                                                                                                                                                               │
        '--node-modules-dir=auto',                                                                                                                                                                                                       │
        'jsr:@pydantic/mcp-run-python',                                                                                                                                                                                                  │
        'stdio',                                                                                                                                                                                                                         │
    ]                                                                                                                                                                                                                                    │
)                                                                                                                                                                                                                                        │
agent = Agent('openai:gpt-4o', mcp_servers=)                                                                                                                                                                                             │
```                                                                                                                                                                                                                                      │
                                                                                                                                                                                                                                         │
### 3. Multiple MCP Servers with Tool Prefixes                                                                                                                                                                                           │
                                                                                                                                                                                                                                         │
```python                                                                                                                                                                                                                                │
# Prevent naming conflicts with tool prefixes                                                                                                                                                                                            │
context7_server = MCPServerHTTP(                                                                                                                                                                                                         │
    url='http://localhost:3001/sse',                                                                                                                                                                                                     │
    tool_prefix='context7'                                                                                                                                                                                                               │
)                                                                                                                                                                                                                                        │
                                                                                                                                                                                                                                         │
weather_server = MCPServerHTTP(                                                                                                                                                                                                          │
    url='http://localhost:3002/sse',                                                                                                                                                                                                     │
    tool_prefix='weather'                                                                                                                                                                                                                │
)                                                                                                                                                                                                                                        │
                                                                                                                                                                                                                                         │
agent = Agent('openai:gpt-4o', mcp_servers=)                                                                                                                                                                                             │
# Tools will be available as: context7_search, weather_get_forecast, etc.                                                                                                                                                                │
```                                                                                                                                                                                                                                      │
                                                                                                                                                                                                                                         │
### 4. Advanced OpenAI Configuration                                                                                                                                                                                                     │
                                                                                                                                                                                                                                         │
```python                                                                                                                                                                                                                                │
from pydantic_ai.models.openai import OpenAIModel, OpenAIResponsesModel                                                                                                                                                                  │
from pydantic_ai.models.openai import OpenAIResponsesModelSettings                                                                                                                                                                       │
from openai.types.responses import WebSearchToolParam                                                                                                                                                                                    │
                                                                                                                                                                                                                                         │
# OpenAI Responses API with built-in tools                                                                                                                                                                                               │
model_settings = OpenAIResponsesModelSettings(                                                                                                                                                                                           │
    openai_builtin_tools=[WebSearchToolParam(type='web_search_preview')],                                                                                                                                                                │
)                                                                                                                                                                                                                                        │
model = OpenAIResponsesModel('gpt-4o')                                                                                                                                                                                                   │
agent = Agent(model=model, model_settings=model_settings)                                                                                                                                                                                │
                                                                                                                                                                                                                                         │
# Custom OpenAI provider configuration                                                                                                                                                                                                   │
from pydantic_ai.providers.openai import OpenAIProvider                                                                                                                                                                                  │
                                                                                                                                                                                                                                         │
model = OpenAIModel(                                                                                                                                                                                                                     │
    'gpt-4o',                                                                                                                                                                                                                            │
    provider=OpenAIProvider(                                                                                                                                                                                                             │
        base_url='https://api.openai.com/v1',                                                                                                                                                                                            │
        api_key='your-api-key'                                                                                                                                                                                                           │
    )                                                                                                                                                                                                                                    │
)                                                                                                                                                                                                                                        │
```                                                                                                                                                                                                                                      │
                                                                                                                                                                                                                                         │
### 5. Complete Example: Context7 Research Agent                                                                                                                                                                                         │
                                                                                                                                                                                                                                         │
```python                                                                                                                                                                                                                                │
import asyncio                                                                                                                                                                                                                           │
from pydantic_ai import Agent                                                                                                                                                                                                            │
from pydantic_ai.mcp import MCPServerHTTP                                                                                                                                                                                                │
                                                                                                                                                                                                                                         │
async def create_context7_research_agent():                                                                                                                                                                                              │
    """Create an agent that uses Context7 for documentation research"""                                                                                                                                                                  │
                                                                                                                                                                                                                                         │
    # Initialize Context7 MCP server                                                                                                                                                                                                     │
    context7_server = MCPServerHTTP(                                                                                                                                                                                                     │
        url='http://localhost:3001/sse',                                                                                                                                                                                                 │
        tool_prefix='context7'                                                                                                                                                                                                           │
    )                                                                                                                                                                                                                                    │
                                                                                                                                                                                                                                         │
    # Create agent with OpenAI GPT-4o                                                                                                                                                                                                    │
    agent = Agent(                                                                                                                                                                                                                       │
        'openai:gpt-4o',                                                                                                                                                                                                                 │
        mcp_servers=,                                                                                                                                                                                                                    │
        system_prompt=(                                                                                                                                                                                                                  │
            "You are a research assistant that uses Context7 to find accurate, "                                                                                                                                                         │
            "up-to-date documentation. Always search Context7 first before providing answers."                                                                                                                                           │
        )                                                                                                                                                                                                                                │
    )                                                                                                                                                                                                                                    │
                                                                                                                                                                                                                                         │
    return agent                                                                                                                                                                                                                         │
                                                                                                                                                                                                                                         │
async def research_topic(topic: str):                                                                                                                                                                                                    │
    """Research a topic using Context7 documentation"""                                                                                                                                                                                  │
                                                                                                                                                                                                                                         │
    agent = await create_context7_research_agent()                                                                                                                                                                                       │
                                                                                                                                                                                                                                         │
    async with agent.run_mcp_servers():                                                                                                                                                                                                  │
        result = await agent.run(                                                                                                                                                                                                        │
            f"Search Context7 for the latest documentation about {topic}. "                                                                                                                                                              │
            f"Provide a comprehensive summary with code examples."                                                                                                                                                                       │
        )                                                                                                                                                                                                                                │
        return result.output                                                                                                                                                                                                             │
                                                                                                                                                                                                                                         │
# Usage                                                                                                                                                                                                                                  │
if __name__ == '__main__':                                                                                                                                                                                                               │
    asyncio.run(research_topic("pydantic-ai agents with MCP"))                                                                                                                                                                           │
```                                                                                                                                                                                                                                      │
                                                                                                                                                                                                                                         │
### 6. Observability with Logfire                                                                                                                                                                                                        │
                                                                                                                                                                                                                                         │
```python                                                                                                                                                                                                                                │
import logfire                                                                                                                                                                                                                           │
from pydantic_ai import Agent                                                                                                                                                                                                            │
                                                                                                                                                                                                                                         │
# Configure observability                                                                                                                                                                                                                │
logfire.configure()                                                                                                                                                                                                                      │
logfire.instrument_pydantic_ai()                                                                                                                                                                                                         │
                                                                                                                                                                                                                                         │
# Your agent will now have detailed tracing                                                                                                                                                                                              │
agent = Agent('openai:gpt-4o', mcp_servers=)                                                                                                                                                                                             │
```                                                                                                                                                                                                                                      │
                                                                                                                                                                                                                                         │
### 7. Streaming Agent Execution                                                                                                                                                                                                         │
                                                                                                                                                                                                                                         │
```python                                                                                                                                                                                                                                │
async def stream_agent_execution():                                                                                                                                                                                                      │
    """Stream agent execution for real-time updates"""                                                                                                                                                                                   │
                                                                                                                                                                                                                                         │
    agent = Agent('openai:gpt-4o', mcp_servers=)                                                                                                                                                                                         │
                                                                                                                                                                                                                                         │
    async with agent.run_mcp_servers():                                                                                                                                                                                                  │
        async with agent.iter("Research pydantic-ai MCP integration") as run:                                                                                                                                                            │
            async for node in run:                                                                                                                                                                                                       │
                if Agent.is_call_tools_node(node):                                                                                                                                                                                       │
                    async with node.stream(run.ctx) as stream:                                                                                                                                                                           │
                        async for event in stream:                                                                                                                                                                                       │
                            if hasattr(event, 'tool_name'):                                                                                                                                                                              │
                                print(f"Calling tool: {event.tool_name}")                                                                                                                                                                │
```                                                                                                                                                                                                                                      │
                                                                                                                                                                                                                                         │
This setup provides you with the latest pydantic-ai capabilities for building AI agents that leverage OpenAI's models while using Context7 as an MCP server for enhanced tool calling and documentation access. 
