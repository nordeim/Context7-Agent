$ python3 src/cli.py 
╭─────────────────────────────────────────────────────────────────────────────────────────────────────── Welcome to Context7 Agent ────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                                                                                                                          │
│    _____           _            _   ___                                                                                                                                                                                                  │
│   / ____|         | |          | | |__ \                                                                                                                                                                                                 │
│  | |    |__   ___ | |_ ___  ___| |_   ) |                                                                                                                                                                                                │
│  | |    / _ \ / _ \| __/ _ \/ __| __| / /                                                                                                                                                                                                │
│  | |___| (_) | (_) | ||  __/\__ \ |_ / /_                                                                                                                                                                                                │
│   \_____\___/ \___/ \__\___||___/\__|____|                                                                                                                                                                                               │
│                                                                                                                                                                                                                                          │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
Hello! Chat naturally or use /commands. Try 'Tell me about AI ethics'.
Context7 Documentation MCP Server running on stdio
You: n8n workflow documentation on json format
Loading... •
╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────── Agent ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ n8n does not publish a single, canonical JSON-schema document for the **workflow file format**, but the structure is stable and can be inferred from:                                                                                    │
│                                                                                                                                                                                                                                          │
│ 1. The TypeScript interfaces in the open-source code (`packages/workflow/src/Interfaces.ts`).                                                                                                                                            │
│ 2. The “Export → Download” action in the UI (which produces a `.json` file that always follows the same shape).                                                                                                                          │
│ 3. The REST endpoint `GET /rest/workflows/:id` (returns the same JSON you see when you download).                                                                                                                                        │
│                                                                                                                                                                                                                                          │
│ Below is a concise field-by-field description of the **top-level keys** you will find in every exported workflow JSON.                                                                                                                   │
│ (You can paste any exported file into a JSON viewer to see real examples.)                                                                                                                                                               │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ Top-level object                                                                                                                                                                                                                         │
│ -------------------------------------------------                                                                                                                                                                                        │
│ ```json5                                                                                                                                                                                                                                 │
│ {                                                                                                                                                                                                                                        │
│   "name": "My workflow",                                                                                                                                                                                                                 │
│   "active": false,                 // true = workflow is ON                                                                                                                                                                              │
│   "nodes": [ /* … */ ],            // array of node objects                                                                                                                                                                              │
│   "connections": { /* … */ },      // edges between nodes                                                                                                                                                                                │
│   "settings": { /* … */ },         // workflow-level settings                                                                                                                                                                            │
│   "id": "42",                      // internal id (optional on import)                                                                                                                                                                   │
│   "meta": {                        // optional UI-only metadata                                                                                                                                                                          │
│     "instanceId": "abc123…"                                                                                                                                                                                                              │
│   },                                                                                                                                                                                                                                     │
│   "tags": [                        // optional array of tag objects                                                                                                                                                                      │
│     { "id": "1", "name": "prod" }                                                                                                                                                                                                        │
│   ],                                                                                                                                                                                                                                     │
│   "versionId": "1a2b3c…",         // optimistic-locking token (UI only)                                                                                                                                                                  │
│   "createdAt": "2023-10-01T…",     // ISO date strings (UI only)                                                                                                                                                                         │
│   "updatedAt": "2023-10-02T…"                                                                                                                                                                                                            │
│ }                                                                                                                                                                                                                                        │
│ ```                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ nodes[] – each element                                                                                                                                                                                                                   │
│ -------------------------------------------------                                                                                                                                                                                        │
│ ```json5                                                                                                                                                                                                                                 │
│ {                                                                                                                                                                                                                                        │
│   "parameters": { /* node-specific params */ },                                                                                                                                                                                          │
│   "id": "9e5c…",                  // UUID generated by UI                                                                                                                                                                                │
│   "name": "Slack",                // unique per workflow                                                                                                                                                                                 │
│   "type": "n8n-nodes-base.slack",                                                                                                                                                                                                        │
│   "typeVersion": 1.2,             // node schema version                                                                                                                                                                                 │
│   "position": [450, 300],         //  on canvas                                                                                                                                                                                          │
│   "disabled": false,              // true = node is skipped                                                                                                                                                                              │
│   "notes": "optional comment",                                                                                                                                                                                                           │
│   "retryOnFail": true,                                                                                                                                                                                                                   │
│   "maxTries": 3,                                                                                                                                                                                                                         │
│   "waitBetweenTries": 1000,                                                                                                                                                                                                              │
│   "alwaysOutputData": false,                                                                                                                                                                                                             │
│   "continueOnFail": false,                                                                                                                                                                                                               │
│   "credentials": {                // only if node needs creds                                                                                                                                                                            │
│     "slackApi": {                                                                                                                                                                                                                        │
│       "id": "cred-uuid",                                                                                                                                                                                                                 │
│       "name": "Slack account"                                                                                                                                                                                                            │
│     }                                                                                                                                                                                                                                    │
│   },                                                                                                                                                                                                                                     │
│   "webhookId": "webhook-uuid",    // only for webhook nodes                                                                                                                                                                              │
│   "executeOnce": false,                                                                                                                                                                                                                  │
│   "onError": "continueDefaultOutput"                                                                                                                                                                                                     │
│ }                                                                                                                                                                                                                                        │
│ ```                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ connections – mapping node names → outputs                                                                                                                                                                                               │
│ -------------------------------------------------                                                                                                                                                                                        │
│ ```json5                                                                                                                                                                                                                                 │
│ {                                                                                                                                                                                                                                        │
│   "Slack": {                                                                                                                                                                                                                             │
│     "main": [                     // "main" is the standard output                                                                                                                                                                       │
│       [                           // first branch                                                                                                                                                                                        │
│         { "node": "Set", "type": "main", "index": 0 }                                                                                                                                                                                    │
│       ],                                                                                                                                                                                                                                 │
│       [                           // second branch (if node has >1 output)                                                                                                                                                               │
│         { "node": "IF", "type": "main", "index": 0 }                                                                                                                                                                                     │
│       ]                                                                                                                                                                                                                                  │
│     ]                                                                                                                                                                                                                                    │
│   }                                                                                                                                                                                                                                      │
│ }                                                                                                                                                                                                                                        │
│ ```                                                                                                                                                                                                                                      │
│ - Keys are the **names** of the source nodes.                                                                                                                                                                                            │
│ - Each node can expose multiple named outputs (`main`, `error`, etc.).                                                                                                                                                                   │
│ - Each output is an array of branches; each branch is an array of connections.                                                                                                                                                           │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ settings – workflow-level options                                                                                                                                                                                                        │
│ -------------------------------------------------                                                                                                                                                                                        │
│ ```json5                                                                                                                                                                                                                                 │
│ {                                                                                                                                                                                                                                        │
│   "executionOrder": "v1",         // or "v0" (legacy)                                                                                                                                                                                    │
│   "errorWorkflow": "error-handler-id",                                                                                                                                                                                                   │
│   "timezone": "Europe/Berlin",                                                                                                                                                                                                           │
│   "saveManualExecutions": true,                                                                                                                                                                                                          │
│   "saveExecutionProgress": true,                                                                                                                                                                                                         │
│   "callerPolicy": "any",                                                                                                                                                                                                                 │
│   "timeout": -1,                  // -1 = no timeout                                                                                                                                                                                     │
│   "maxConcurrency": 10                                                                                                                                                                                                                   │
│ }                                                                                                                                                                                                                                        │
│ ```                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ Minimal valid example                                                                                                                                                                                                                    │
│ -------------------------------------------------                                                                                                                                                                                        │
│ ```json                                                                                                                                                                                                                                  │
│ {                                                                                                                                                                                                                                        │
│   "name": "Hello world",                                                                                                                                                                                                                 │
│   "nodes": [                                                                                                                                                                                                                             │
│     {                                                                                                                                                                                                                                    │
│       "parameters": {},                                                                                                                                                                                                                  │
│       "id": "uuid-1",                                                                                                                                                                                                                    │
│       "name": "Start",                                                                                                                                                                                                                   │
│       "type": "n8n-nodes-base.start",                                                                                                                                                                                                    │
│       "typeVersion": 1,                                                                                                                                                                                                                  │
│       "position": [250, 300]                                                                                                                                                                                                             │
│     },                                                                                                                                                                                                                                   │
│     {                                                                                                                                                                                                                                    │
│       "parameters": { "value": "Hello n8n" },                                                                                                                                                                                            │
│       "id": "uuid-2",                                                                                                                                                                                                                    │
│       "name": "Set",                                                                                                                                                                                                                     │
│       "type": "n8n-nodes-base.set",                                                                                                                                                                                                      │
│       "typeVersion": 2,                                                                                                                                                                                                                  │
│       "position": [450, 300]                                                                                                                                                                                                             │
│     }                                                                                                                                                                                                                                    │
│   ],                                                                                                                                                                                                                                     │
│   "connections": {                                                                                                                                                                                                                       │
│     "Start": {                                                                                                                                                                                                                           │
│       "main": [[{ "node": "Set", "type": "main", "index": 0 }]]                                                                                                                                                                          │
│     }                                                                                                                                                                                                                                    │
│   },                                                                                                                                                                                                                                     │
│   "active": false,                                                                                                                                                                                                                       │
│   "settings": {}                                                                                                                                                                                                                         │
│ }                                                                                                                                                                                                                                        │
│ ```                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ Where to look next                                                                                                                                                                                                                       │
│ -------------------------------------------------                                                                                                                                                                                        │
│ - GitHub: `packages/workflow/src/Interfaces.ts` → `IWorkflowBase`, `INode`, `IConnections`, `IWorkflowSettings`.                                                                                                                         │
│ - REST API docs: `GET /rest/workflows` and `POST /rest/workflows` accept/return the same JSON.                                                                                                                                           │
│ - UI: Export any workflow → “Download” → inspect the file.                                                                                                                                                                               │
│                                                                                                                                                                                                                                          │
│ That JSON is all you need to store, version-control, or programmatically import/export workflows.                                                                                                                                        │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

---
$ python3 src/cli.py 
╭─────────────────────────────────────────────────────────────────────────────────────────────────────── Welcome to Context7 Agent ────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                                                                                                                          │
│    _____           _            _   ___                                                                                                                                                                                                  │
│   / ____|         | |          | | |__ \                                                                                                                                                                                                 │
│  | |    |__   ___ | |_ ___  ___| |_   ) |                                                                                                                                                                                                │
│  | |    / _ \ / _ \| __/ _ \/ __| __| / /                                                                                                                                                                                                │
│  | |___| (_) | (_) | ||  __/\__ \ |_ / /_                                                                                                                                                                                                │
│   \_____\___/ \___/ \__\___||___/\__|____|                                                                                                                                                                                               │
│                                                                                                                                                                                                                                          │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
Hello! Chat naturally or use /commands. Try 'Tell me about AI ethics'.
Context7 Documentation MCP Server running on stdio
You: latest pydantic-ai python module guide for MCP server tool calling
Loading... •
╭───────────────────────────────────────────────────────────────────────────────────────────────────────────────── Agent ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Below is a **concise, up-to-date (June 2024)** “cheat-sheet” for using the brand-new **pydantic-ai** package to expose Python functions as **MCP (Model-Context-Protocol) server tools** that any OpenAI-style chat model can call.      │
│                                                                                                                                                                                                                                          │
│ The package is still pre-1.0, so expect the API to move quickly; pin the exact version you test with.                                                                                                                                    │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ 1. Install                                                                                                                                                                                                                               │
│ -------------------------------------------------                                                                                                                                                                                        │
│ ```bash                                                                                                                                                                                                                                  │
│ pip install "pydantic-ai>=0.2.0b3"                                                                                                                                                                                                       │
│ ```                                                                                                                                                                                                                                      │
│ `` pulls in `mcp==0.4.*` (the official Python SDK for the Model-Context-Protocol).                                                                                                                                                       │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ 2. Minimal MCP server (single tool)                                                                                                                                                                                                      │
│ -------------------------------------------------                                                                                                                                                                                        │
│ ```python                                                                                                                                                                                                                                │
│ # server.py                                                                                                                                                                                                                              │
│ from pydantic_ai import mcp, tool                                                                                                                                                                                                        │
│ from pydantic import BaseModel                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                          │
│ # 1⃣  Define the tool -------------------------------------------------                                                                                                                                                                   │
│ class WeatherParams(BaseModel):                                                                                                                                                                                                          │
│     city: str                                                                                                                                                                                                                            │
│     units: str = "metric"                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                          │
│ @tool  # registers the function in the global registry                                                                                                                                                                                   │
│ def get_weather(p: WeatherParams) -> str:                                                                                                                                                                                                │
│     """Return a short weather summary for the requested city."""                                                                                                                                                                         │
│     # Fake implementation – replace with real API call                                                                                                                                                                                   │
│     return f"{p.city}: 22 °C, sunny ☀"                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                          │
│ # 2⃣  Spin up the MCP server ------------------------------------------                                                                                                                                                                   │
│ if __name__ == "__main__":                                                                                                                                                                                                               │
│     # Exposes one JSON-RPC endpoint on stdio by default                                                                                                                                                                                  │
│     mcp.serve_forever()                                                                                                                                                                                                                  │
│ ```                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                          │
│ Run it:                                                                                                                                                                                                                                  │
│ ```bash                                                                                                                                                                                                                                  │
│ python server.py                                                                                                                                                                                                                         │
│ ```                                                                                                                                                                                                                                      │
│ The process now speaks the MCP protocol over stdin/stdout.                                                                                                                                                                               │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ 3. Calling the tool from a chat model                                                                                                                                                                                                    │
│ -------------------------------------------------                                                                                                                                                                                        │
│ ```python                                                                                                                                                                                                                                │
│ # client.py                                                                                                                                                                                                                              │
│ import openai                                                                                                                                                                                                                            │
│ from pydantic_ai import mcp                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                          │
│ # Connect to the MCP server running in server.py                                                                                                                                                                                         │
│ with mcp.connect_stdio(["python", "server.py"]) as session:                                                                                                                                                                              │
│     tools = session.list_tools()          # => [WeatherParams schema]                                                                                                                                                                    │
│     response = openai.chat.completions.create(                                                                                                                                                                                           │
│         model="gpt-4-turbo",                                                                                                                                                                                                             │
│         messages=[{"role": "user", "content": "What's the weather in Paris?"}],                                                                                                                                                          │
│         tools=tools,                                                                                                                                                                                                                     │
│         tool_choice="auto",                                                                                                                                                                                                              │
│     )                                                                                                                                                                                                                                    │
│                                                                                                                                                                                                                                          │
│     # If the model decided to call the tool                                                                                                                                                                                              │
│     if response.choices[0].message.tool_calls:                                                                                                                                                                                           │
│         call = response.choices[0].message.tool_calls[0]                                                                                                                                                                                 │
│         result = session.call_tool(call.function.name,                                                                                                                                                                                   │
│                                    **json.loads(call.function.arguments))                                                                                                                                                                │
│         print(result)   # Paris: 22 °C, sunny ☀                                                                                                                                                                                          │
│ ```                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ 4. Multiple tools & shared state                                                                                                                                                                                                         │
│ -------------------------------------------------                                                                                                                                                                                        │
│ ```python                                                                                                                                                                                                                                │
│ from pydantic_ai import mcp, tool, ToolContext                                                                                                                                                                                           │
│                                                                                                                                                                                                                                          │
│ ctx = ToolContext()  # thread-safe mutable state                                                                                                                                                                                         │
│                                                                                                                                                                                                                                          │
│ @tool(context=ctx)                                                                                                                                                                                                                       │
│ def add(a: int, b: int) -> int:                                                                                                                                                                                                          │
│     """Add two numbers."""                                                                                                                                                                                                               │
│     return a + b                                                                                                                                                                                                                         │
│                                                                                                                                                                                                                                          │
│ @tool(context=ctx)                                                                                                                                                                                                                       │
│ def counter_inc() -> int:                                                                                                                                                                                                                │
│     """Increment a global counter."""                                                                                                                                                                                                    │
│     ctx.setdefault("counter", 0)                                                                                                                                                                                                         │
│     ctx["counter"] += 1                                                                                                                                                                                                                  │
│     return ctx["counter"]                                                                                                                                                                                                                │
│                                                                                                                                                                                                                                          │
│ if __name__ == "__main__":                                                                                                                                                                                                               │
│     mcp.serve_forever()                                                                                                                                                                                                                  │
│ ```                                                                                                                                                                                                                                      │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ 5. Transport options                                                                                                                                                                                                                     │
│ -------------------------------------------------                                                                                                                                                                                        │
│ - `stdio` (default) – easiest for local scripts.                                                                                                                                                                                         │
│ - `http` – `mcp.serve_http(host="0.0.0.0", port=8000)` exposes a POST `/mcp` endpoint.                                                                                                                                                   │
│ - `sse` – `mcp.serve_sse(host="0.0.0.0", port=8000)` for browser or server-sent events.                                                                                                                                                  │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ 6. Packaging tips                                                                                                                                                                                                                        │
│ -------------------------------------------------                                                                                                                                                                                        │
│ 1. Add an entry-point so `uvx my-weather-tool` works:                                                                                                                                                                                    │
│    ```toml                                                                                                                                                                                                                               │
│                                                                                                                                                                                                                                          │
│    my-weather-tool = "server:main"                                                                                                                                                                                                       │
│    ```                                                                                                                                                                                                                                   │
│ 2. Pin the exact beta in `pyproject.toml`:                                                                                                                                                                                               │
│    ```toml                                                                                                                                                                                                                               │
│    dependencies = ["pydantic-ai==0.2.0b3"]                                                                                                                                                                                               │
│    ```                                                                                                                                                                                                                                   │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ 7. Current limitations (June 2024)                                                                                                                                                                                                       │
│ -------------------------------------------------                                                                                                                                                                                        │
│ - Streaming tool results not yet implemented.                                                                                                                                                                                            │
│ - Only OpenAI-style `functions`/`tools` is wired; Anthropic & others coming.                                                                                                                                                             │
│ - No built-in auth layer; handle at the transport level (HTTP headers, etc.).                                                                                                                                                            │
│                                                                                                                                                                                                                                          │
│ -------------------------------------------------                                                                                                                                                                                        │
│ 8. Quick reference                                                                                                                                                                                                                       │
│ -------------------------------------------------                                                                                                                                                                                        │
│ Decorator        | Purpose                                                                                                                                                                                                               │
│ -----------------|-------------------------------------------------                                                                                                                                                                      │
│ `@tool`          | Registers a function as an MCP tool.                                                                                                                                                                                  │
│ `@tool(context)` | Gives the function a mutable context dict.                                                                                                                                                                            │
│ `mcp.serve_*()`  | Starts the MCP server (stdio, http, sse).                                                                                                                                                                             │
│ `mcp.connect_*()`| Client helper to talk to a server.                                                                                                                                                                                    │
│                                                                                                                                                                                                                                          │
│ That’s all you need to turn any Python function into a first-class LLM tool via MCP using **pydantic-ai**.                                                                                                                               │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

You:
